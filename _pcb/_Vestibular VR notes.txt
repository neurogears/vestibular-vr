

>> Vestibular VR Project <<
	- Rotary Stage for 2D navigation 
	- In mice for Neurocience and Behaviour experiments
	> project with Neurogears & Univ Marselha

>> GENERAL INFO <<
	People involved
		Ede Rancz <Ede.Rancz@crick.ac.uk>
		Xavier Cano Ferrer <xavier.cano-ferrer@crick.ac.uk> - 
			Engineer at Crick that designed the device
		Mathias - 
			Is doing the 3D printings, works in the fab lab

NeuroGEARS: 
	. Project leader: Andrew Erskine
	. GitHub to interface with Ede
		https://github.com/neurogears/vestibular-vr/issues
	. Files will be on GitHub as well
		https://github.com/neurogears/vestibular-vr
	. Also have files on GoogleDrive
		G:\My Drive\management\external projects\NGR\2201 VestibularVR Ede Rancz Marseille
	. Info on 
		https://docs.google.com/document/d/12CUnzF7pFWBNZng8NylbyNUOLclV19EQ2G7OUyfC5wM/edit



>>  main goal: 
		- rebuild hw module to make it simple on wiring & assembling & data aquisition and processing
			.  hw rebuild made with harp hw & fw modules
			. data aquisition & processing made with Bonsai

************************************************************************************************
************************************************************************************************
************************************************************************************************


* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @November 12th 2022	

>> starting design of 		Harp Motor device H2-module v1.0
	
	> meeting notes @ 23-05-2022
		Optical flow acquired at 100Hz seems reasonable to Ede.		<< WHICH OPTICAL FLOW IS THIS????
	
	> meeting notes @ 17-06-2022
		Mouse has the flow control: we can't have a timestamp but the precision and sample rate (>= 1KH) is very good.
		the major issue is jitter, no latency
	
	
	
	> NOTES about Requirements:
		• mouse movement is tracked by optical sensors measuring movement induced by mouse on the treadmill (polystyrene sphere kept afloat with compressed air)	>> OK
		
		• "Control of vestibular platform rotation"
			. rotary platform actuated by a stepper motor using time belt (...) rotaded with variable latencyresolution 0.1º
				>> where one is the control of this step motors? 	EXTERNAL (Filipe)
				>> motor control DM542 	
				>> PDF OK
					>> final goal: control DM542 motor driver		
						TBD
				
		• "incremental encoder coupled to motor shaft"		
				>> Wisamic 600p/r   LPD3806-600BM-G5-24C
				>> Incremental Rotary Encoder Dc5-24v Wide Voltage Power Supply 6mm Shaft
				>> PDF OK
					>> final goal:	read IOs about encoder
						TBD
				
		• "Hall effect sensors are used for homing purposes"	
				>> H2 module OK!!
				>> WINGONEER 5Pcs Hall Effect KY-003 Magnetic Sensor Module DC 5V For Arduino PIC AVR Smart Cars
				>> PDF OK
					>> final goal: read IO about Hall Effect sensor
						TBD
						
		• "emergency stop button which should immediately halt any movement"	
				>> H2 module !! OK
					>> final goal: read Interrupt IO from Emergency Buttuon; Level translation: Button@ 12V & micro @3V3		
						TBD
		
		• "weight board the rotary platform is up to 2kg and requires a motor with 'specs'
				>> NO SPECS ABOUT THE MOTOR!!!!!!!!!!
				>> no need - only about motor control/driver
				>> OK
				
		• "Closed-loop & Open-loop" modularity
			. closed-loop - rotation of treadmill is feedback to motor control
									latency motion->motor feedback is <XXX		
										>> LATENCY TO BE DEFINED
									feedback gain able to be adjusted
		
			.open-loop		- platform rotation is independent from treadmill movement & is experimented controlled
			
				>> these things should be 'easy' push-pull/on-off?
					or Bonsai is enough to control it?
					If 'easy´push-pull other mech terminals should be thought to put in
						TBD
		
		• "Modularity" - system 'shuld' be able adding & removing components from rotary platform
				e.g. headpos holder, camera, eye-tracking..		
					>> hw removing and/or sw removing??
			
			
		• "VR- setup is surrounded by 4 static screens providing a complete VR surround to assembly"
				>> power & control on these issues - nothing to do with us, right?		
					NOTHING WITH ME - OK!!
		
		• "..off-platform secondary HARP device will integrate signals from (...) rotary platform [our HARP] and off platform sensors (hall-effect, rotary sensors) and ULTIMATELY DRIVE PLATFORM MOTOR
				>> drives from BONSAI interface..
				>> OK
				
		• 2 HARP device - OnBoard & OffPlatform [Motor Device] MUST have means of syncronising their sample clocks	
				>> OK
			
		• HARP CLOCK GENERATOR: SHOULD/CAN BE COMPLETED INTEGRATED IN H2 MODULE??
				>> NO!! Will be out Clock Generator - an external module - with several outputs
				>> OK
		
		
		

* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @November 11th 2022	
>> end BOM
	. specific PN about headers and plugs
		pcb header 5way MPN: 20.155MH/5-E	Frnll: 2517861
		wire plug	5 way	MPN: 20.1550M/5-E	Frnll: 2575218

		

	. PN about buffers 74LVC1G07DBV (74LVC1G07) - not in OEPS
	
	. PN & site about camera
		PAA5100JE		Near Optical Flow SPI Breakout
		Detect motion of close-up surfaces with this Breakout Garden compatible optical navigation breakout - great for floor tracking for ground dwelling robots!
		PAA5100JE		Near Optical Flow SPI Breakout
			https://shop.pimoroni.com/products/paa5100je-optical-tracking-spi-breakout?variant=39315330170963
			https://cdn.shopify.com/s/files/1/0174/1800/files/PAA5100JE_PIM573_schematic.pdf?v=1621247278
		

>> VestibularVR H1-module v1.0
	. hw built and tested
	. buffers not available were replaced by equivalent; wire shunts needed to be done
	. more critical error: USBD+ & USDM- on FTDI pins were switched after FTDI buffer
		- copper cutted and shunts done with wire
		- if at high freq, have trouble on comm new board with this correction must be done immediatly
	
	. next step: start fw development
	

* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @October 2nd 2022	

>>1st step design restarted to be done in Eagle


* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @Setembro 26th 2022	

>> 1st step PCB design finished:
	- next steps:
		. a review with Filipe
		. decide about IC buffers in SPI lines (??); in & out it makes difficult to have pieces for it
		. decide about IC buffers/level shift in H1-board-IOs plug; believe must be!!
		. optmizing PSU stages; was dimensioned to high current LEDs & FANs; 
			1st 12V stage can be optimized!!
		. tes points in:
			- power rails
			- free u pads
			- others?? decide which ones..


* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @Setembro 22th 2022	


>> data sent from Andrew:
	- valve:
		. PN to be used: LHDB0633280D
				[1st PN sent LHDA1233115H 3-way LEE valve, and then corrected ]

					PN			actuation V					power			internal 	plunger
														hold V		@hold V			seal			head
			LHDB0633280D 	12V 				6V		 590mW	 		FKM 		PPA
			I_hold=0.6/6=100mA
			
			
		. abstract datasheet: PDS-106-2015-07-Lo-LohmHDISolenoidValve
		
		. [our valve common used: LHDA1231115H]


		

	- lick sensor:
		'Lick sensor will most likely be the same as in the mice poke simple v1.2 (from champalimaud hardware)
			https://github.com/harp-tech/harp_behavior/blob/master/PCB%20modules/Port%20Breakout/harp%20behavior%20poke%20port%20breakout%20v1.1.pdf
			. lick sensor on PokeSimple_V1.1	852-GP1A57HRJ00F
			
			.lick sensor referenced
				This is the port breakout we are aiming to copy		PhotointerrupterMouser	852-GP1A57HRJ00F
				https://pt.mouser.com/ProductDetail/Sharp-Microelectronics/GP1A57HRJ00F?qs=bgJ5QXnU1LTpUr5Jbs6P8Q%3D%3D

			. lick sensor is same in both projects >> OK

* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @Setembro 19th 2022	

>> investing on choosing to H1 module:	email@September 16th
	- valves for water delivery
			- the one beeing used (12V)		https://www.theleeco.com/product/lhd-series-2-3-way-control-solenoid-valves/
			
	- lick detection sensors:
		. Ede says 'option to use either the beam-break or capacitive sensor'
			- capacitive touch sensor already used (5V)		https://www.adafruit.com/product/1374
			- beam-break (similar) 									http://brianisett.com/2016/03/26/diy-lickometer/#lick-circuit
	
	>> opinion from sensores above - either valves & lick detection:
			1st:	electronic control is 'simple' way to manage any of it; 12V rail is available in H1 module; any valve & sensor up to this voltage can be easily controled
			2nd: 	main issue when chossing will be:
						. how these components are built or which component is preffered to be bought
						. it's mechanical integration in the whole system - doesn't have to do with us!
			
				> on these stage then, chossing these parts should/must be done by Manchester or others
			
			



>> micro to be used:
	AtxMega 3A2A4U


* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 
*  @16 Setembro 2022	

>> em H1-harp configuration
	- IR device
		. to detect mouse already went to get water
		. waiting for feedback from university to know about PN suggestion
		. similar ao circuito harp OnPoke(??)

>> em H2-Motor Device

	- what for Treadmill motion & Motor pins on H2 Module?
		. Treadmill motion:
			sensor measuring sphere movement
		&
		. Motor
			step motor control
		
		> Treadmill & Step control pins have to available to test open & closed loop control
		
		
	- photodiode to syncronize screens - if used will be connected on this module H2
			. not sure if will be used
			. if so, will be connected on extra IOs left on H2 board
			

>> notas sem sentido:
	. em falta o módulo de um motor?? Bruno ainda não tinha visto todo o esquema??
	. 'similar to Behaviour Board'... Bruno q referiu.. a q se referia??

	
	
	


********************************
* 13 Setembro 2021

PN:
	- photodiode digital junto ao tubo da água - para detectar a água ou a lingua ??
	- válvulas, por exemplo, para desenhar o circuito que a vai atacar
	
	
	

********************************
* 9 Setembro 2021

>> ToDos by now after 1st meeting (check it out :||)

	- rotary wiring to 2x USB_cameras & 5 IOs inside H1-rotary stage
		2 USB cables
		+
		5 extra IOs

	- clarify on H1-module:
		. IR diodes - photodiodes??  to tongue detections??
		. refered as UDK? ports??
		
		
	
	- boost or step-up to electrovalves on rotary stage..
		. was it taken as a final solution? 
		. be sure about 2 electrovalves (1 spare?)		<< decide about what valve and it's control
		
	
	
>> In-Out IR (NEW ??)
	PAA5100JE Near Optical Flow SPI Breakout
		Detect motion of close-up surfaces with this Breakout Garden compatible optical navigation breakout - great for floor tracking for ground dwelling robots
		https://shop.pimoroni.com/products/paa5100je-optical-tracking-spi-breakout?variant=39315330170963
		https://cdn.shopify.com/s/files/1/0174/1800/files/PAA5100JE_PIM573_schematic.pdf?v=1621247278



>> OEPS responsability about modules módulos to be done:
	
	H1 >> modules inside rotary stage: 
			- 1 LED control to pupil's mouse excitation
			- 2 electrovalves control to supply mouse water; 12V control
			- 2 'moving detect' sensores on main sphere to know about mouse movement
			- 1 screen LDR sensor (light black&white on a corner ??) to know about which frame screen is; to syncronize mouse movement & screen images (?)
			- IR diodes on board?? what for? with flat cable.. must have plugs.. don't have notes to remember about it
			
			
			
	H2 >> modules on a 'stoped' stage:
			- step-motor control
			- step-motor encoder reading & data sharing
			- step-mootor increasing sensor/encoder 
			- hall effect sensor & for data reading and & sharing; know about ALL-platform moving???
			- Main Emergency Button to disable all system
		


	> design must be made in Eagle!
	>	OPES responsability:
		. to design & build & assembling boards
















************************************************************************************************
************************************************************************************************
************************************************************************************************
************************************************************************************************
************************************************************************************************
************************************************************************************************
************************************************************************************************


********************************
* 16-08-2022
	Due to the slip ring restriction, the camera needs to be USB2.0.
	Andrew will check with Ede the valves (voltages) and lick ports they are using.
	DrawIO: https://drive.google.com/file/d/1IXwrk58W3oOoU6d4bJTaxhsgl-Ja3gbr/view?usp=sharing

Previous notes
	Updated documentation:
		https://atranvan.github.io/vestibular_setup/
		https://github.com/neurogears/vestibular-vr

	Optical options:
		PMW3360
		https://www.pixart.com/products-detail/10/PMW3360DM-T2QU
		https://pdf1.alldatasheet.com/datasheet-pdf/view/899001/PIXART/PMW3360.html

	https://github.com/SunjunKim/PMW3360_Arduino
	https://geekhack.org/index.php?topic=100027.0

	ADNS3050 -- didn't find good documentation and seems to be obsolete


********************************
* 17-06-2022

We will use GitHub to keep track of things.
	GitHub: 
		https://github.com/neurogears/vestibular-vr


Mouse as the flow control: 
	we can't have a timestamp but the precision and sample rate (>= 1KH<) is very good.
	The distance between the mouse/flow control sensor changes in time because the ball is floating and moves the center of mass when the animal is walking.
	To Ede, the major issue is jitter, no latency. The animal learns if there's a delay of less than 16 or 17 ms but will not learn if there's a significant jitter.

The SQUAl value of the current sensor used in the setup is stated in the document (Rotary stage documentation.pdf).

VR: There are two approaches:
 - VR googles, use two screens in front of the animal.
 - Cave, which uses a round screen around the animal.

Ede:
	" The idea is to cover the animal field of view as much as possible.
	If surrounding the animal is possible, that's ideal.
	A stationary screen has a lot of advantages.
	We've chosen the google approach because it was easier for the Ph.D. student that was doing the work."

Slip ring:
	ONIX coax
	Cameras
	And hardware timestamp of these (trigger or strobe from cameras)
	We may need a hole to blow air to the ball
	Spinner, na have a solution for that.
	The rotation platform should be as cheap and simple as possible to be open source.

Screens used by NGR on other experiments for high speed 240Hz and low latency.
	https://www.amazon.co.uk/Alienware-AW2721D-2560x1440-DisplayPort-Adjustable/dp/B08NFBBTTL	https://www.dell.com/en-uk/shop/alienware-27-gaming-monitor-aw2721d/apd/210-axnu/monitors-monitor-accessories#techspecs_section

Ede says that using 6 screens in portrait can be a good idea to increase the filed of view.





********************************
* 23-05-2022
-> First meeting notes 23-05-2022
	. Optical flow acquired at 100Hz seems reasonabale to Ede.
	. Round screen: link
	. The PCB will be outside of the board
		https://www.kicad.org/download/windows/
		https://github.com/Aharoni-Lab/Miniscope-v4/archive/refs/heads/master.zip





	